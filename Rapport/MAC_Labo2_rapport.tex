% -----------------------------------------------------------------------
% --- DOCUMENTS ---
% -----------------------------------------------------------------------
\documentclass[11pt, a4paper, french, twoside]{article}
\usepackage[utf8]{inputenc}
\usepackage{ae, pslatex}
\usepackage[french]{babel}
\selectlanguage{french} 

\usepackage[table]{xcolor}

\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{pgfplots}
\usepackage{caption}
\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,      
	urlcolor=cyan,
}

\usepackage{titlesec}
\usepackage{color}
\usepackage{colortbl}

\usepackage{hhline,tabu}


\frenchbsetup{StandardLists=true}

\usepackage{etoolbox}


\usepackage{listings} % pour afficher du code
\usepackage{color}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{  
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    backgroundcolor=\color{gray!10},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,
    framexleftmargin = 1em,
    framextopmargin = 1em,
    framexbottommargin=1em, 
    frame=tb, framerule=0pt,
    tabsize=4
}

\lstset{style=mystyle}

% -----------------------------------------------------------------------
% --- MARGES ---sp
% -----------------------------------------------------------------------
\usepackage{vmargin}
\setpapersize{A4}
\setmarginsrb{60pt}{50pt}{60pt}{25pt}{15pt}{25pt}{15pt}{25pt}

% -----------------------------------------------------------------------
% --- EN-TETE ET PIED DE PAGE ---
% -----------------------------------------------------------------------
\usepackage{fancyhdr}
\usepackage{lastpage}
\pagestyle{fancy}

\fancyhead[L]{MAC - Applications multi-tiers}
\fancyhead[R]{IL - TIC - HEIG-VD \\ Automne 2017}
\fancyfoot[C]{\thepage{}}

\title{Applications multi-tiers \\ Laboratoire n\textordmasculine2 : Transactions}
\author{Mathieu Monteverde, Sathiya Kirushnapillai, Michela Zucca}
\date{Automne 2017}

\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
\titlespacing\subsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
\titlespacing\subsubsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}


% ***********************************************************************
% *** DOCUMENT PRINCIPAL ***
% ***********************************************************************
\begin{document}
	
	\maketitle
	
	\setlength{\parskip}{1em}
	
	\section{Codes implémentés}
    
    \subsection{SQL}
    Pour ce laboratoire, nous avons désactivé l'auto-commit par défaut de MySQL. Ainsi, nous devons gérer nous-même chaque transaction. 
    
	\lstinputlisting[language=SQL,firstline=190,lastline=191]{../labo2_procedures.sql}
    
    \subsubsection*{Transfert 1}
    Nous devons réaliser ce premier transfert sans encadrement \og start transaction commit \fg. Il n'y a rien de particulier à constater. Nous avons simplement rédiger ce code à l'aide du pseudo-code présenté dans la données du laboratoire.
    
    \lstinputlisting[language=SQL,firstline=201,lastline=227]{../labo2_procedures.sql}
    
    \subsubsection*{Transfert 2}
    Pour ce transfert, nous avons un code identique au premier transfert ci-dessus. La seule différence est que nous travaillons en mode transactionnel à l'aide de l'encadrement \og start transaction commit \fg. Aucun verrouillage n'a été implémenté.
    
    \lstinputlisting[language=SQL,firstline=238,lastline=267]{../labo2_procedures.sql}
    
    
    \subsubsection*{Transfert 3}
    Le code ci-dessous est identique au second transfert. Cependant, nous devons implémenter un verouillage explicite des données sensibles en obéissant au \og verrouillage en deux phases, en verrouillant le plus tard possible. \fg
    
    Pour le verrouillage, on utilise \textit{FOR UPDATE}.
    
    \lstinputlisting[language=SQL,firstline=279,lastline=310]{../labo2_procedures.sql}
    
    \subsubsection*{Transfert 4}
    
    
    
	\section{Tests réalisés}
    
	\subsection{Mode non transactionnel}

	
	\subsection{Mode transactionnel}
    Le tableau ci-dessous compare les différences entre les différents niveau d'isolation.
    
    \definecolor{BGray}{gray}{0.60}
    \definecolor{Gray}{gray}{0.85}
    \newcolumntype{a}{>{\columncolor{Gray}}c}

    \begin{tabular}{|a|l|l|l|l|}
        \hline
        \rowcolor{BGray}
                                    & Read Uncommitted & Read Committed & Repeated Read & Serializable \\
        \hline
        Nombre d'inter-blocage      & & & & \\
        \hline
        Temps d'exécution           & & & & \\
        \hline
        Solde initial compte A      & 500 & 500 & 500 & 500 \\
        \hline
        Solde initial compte B      & 500 & 500 & 500 & 500 \\
        \hline
        Solde final compte A        & & & & \\
        \hline
        Solde final compte B        & & & & \\
        \hline
    \end{tabular}
    

\end{document}
